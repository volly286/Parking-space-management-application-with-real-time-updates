# Parking Management Application

## 1. Description

The parking management application allows users to reserve a parking spot and view availability in real-time.

## 2. Application Resources

- Python: [Python Download Link](https://www.python.org/downloads/)
  - Click the **Download** button as shown in the image above.
  - Download version 3.9.10 by clicking the download button next to it.
  - Scroll down until you find the image and select **Windows Installer (64-bit)**.
  - After downloading the file, open it by double-clicking.
  - Ensure the settings are correctly configured, then click **INSTALL NOW**.
  - In the security prompt, click **Yes**.
  - After installation is complete, click **Close**.

- XAMPP: [XAMPP Download Link](https://www.apachefriends.org/ro/download.html)
  - Click the **Download** button to get the latest version 8.2.12.
  - After downloading the file, open it by double-clicking.
  - In the security prompt, click **Yes**.
  - Click **Next**.
  - Click **Finish** to complete the installation.

## 3. Database Configuration

### Starting XAMPP:
1. Open the XAMPP Control Panel and start the Apache and MySQL services.

### Database Configuration:
1. Click **Admin** next to MySQL to access phpMyAdmin.
2. Create a database named **Proiect** and import the **proiect.sql** file (which you can download from your project).
3. Ensure the `users` and `parking_spots` tables are created.

## 4. Application Setup

### Verify Python Installation:
In CMD, use the command:
```bash
python --version
```

### Navigate to the Application's Root Folder:
- Ensure the `app.py` file, `static` folder, and `templates` folder are present.

### Starting the Application:
- In the terminal, navigate to the application's folder and use the command:
  ```bash
  python app.py
  ```
- You will receive access links in **CMD** to open the application in your browser.

### Modify the `script.js` File:
1. Open the `script.js` file from the `static/js/` folder.
2. Locate the following code snippet:
   ```html
   <script>
       var socket = io.connect('replace_with_your_link');
   </script>
   ```
3. Replace `replace_with_your_link` with the link generated by **ngrok**.

## 5. Possible Errors and Solutions

### NGROK Error - ERR_NGROK108:
When running the `python app.py` command, **ngrok** may display an **ERR_NGROK108** error without showing the connection links. To resolve this error, press **CTRL + C** once to stop the process, and then retry running the command.

### Error Replacing the Link in `script.js`:
When replacing the ngrok-generated link in the `script.js` file, ensure the link follows the correct format:
```bash
https://yourlink/
```
If you omit **HTTPS** and the trailing **/**, real-time updates will not work correctly.

## 6. Key Application Functions

### Reservation Function (Python + Flask)
```python
@app.route('/reserve/<int:spot_id>')
def reserve(spot_id):
    user_id = session.get('UserID')
    if not user_id:
        return redirect(url_for('login'))
    cur = mysql.connection.cursor()
    # Check if the user already has a reserved spot
    cur.execute("SELECT * FROM parking_spots WHERE reserved_by = %s", (user_id,))
    if cur.fetchone():
        flash('You already have a reserved spot', 'error')
        cur.close()
        return redirect(url_for('index'))
    # Check if the spot is available
    cur.execute("SELECT * FROM parking_spots WHERE spot_id = %s AND is_reserved = False", (spot_id,))
    spot = cur.fetchone()
    if spot:
        # Retrieve license number from the database
        cur.execute("SELECT license_number FROM users WHERE id = %s", (user_id,))
        user_data = cur.fetchone()
        user_license_number = user_data['license_number']
        # Reserve the spot
        cur.execute("UPDATE parking_spots SET is_reserved = True, reserved_by = %s, license_number = %s WHERE spot_id = %s",
                    (user_id, user_license_number, spot_id))
        mysql.connection.commit()
        # Emit event for real-time update
        socketio.emit('update_parking_spot', {'spot_id': spot_id, 'status': 'reserved', 'license_number': user_license_number})
        cur.close()
    return redirect(url_for('index'))
```

### Reservation Function (JavaScript)
```javascript
function reserveSpot(spotId) {
    window.location.href = '/reserve/' + spotId;
}

var socket = io.connect('https://4eb3-213-233-104-136.ngrok-free.app/'); // link generated by ngrok
socket.on('update_parking_spot', function(data) {
    var spotElement = document.getElementById("spot-" + data.spot_id);
    if (spotElement) {
        var statusText = 'Spot ' + data.spot_id;
        if (data.status === 'reserved') {
            spotElement.classList.add('reserved');
            spotElement.removeAttribute('onclick');
            statusText += ' (Reserved by ' + data.license_number + ')';
        } else {
            spotElement.classList.remove('reserved');
            spotElement.setAttribute('onclick', 'reserveSpot("' + data.spot_id + '")');
            statusText += ' (Available)';
        }
        spotElement.textContent = statusText;
    }
});
```

## 7. Useful Python-Ngrok Link
- [YouTube Tutorial](https://www.youtube.com/watch?v=m7ucpSTtqEo&ab_channel=CodegnanDestination)

